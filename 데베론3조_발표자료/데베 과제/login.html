<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>로그인 / 비밀번호 찾기</title>
  <style>
    body {
      font-family: 'Noto Sans KR', sans-serif;
      background-color: #f4f6f8;
      margin: 0;
      padding: 0;
    }
    .top-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background-color: #2c3e50;
      color: white;
      padding: 12px 20px;
      font-weight: bold;
    }
    .logo {
      font-size: 18px;
      cursor: pointer;
      color: white;
      text-decoration: none;
    }
    .top-bar a.home {
      color: #1abc9c;
      text-decoration: none;
      font-size: 14px;
    }
    .container {
      max-width: 400px;
      margin: 60px auto;
      background: #fff;
      padding: 30px 40px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    h2 { text-align: center; color: #2c3e50; }
    label { display: block; margin: 15px 0 5px; font-weight: bold; color: #333; }
    input[type="text"], input[type="password"], input[type="email"] {
      width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; font-size: 14px;
    }
    button {
      width: 100%; padding: 10px;
      background-color: #1abc9c; color: white;
      border: none; border-radius: 8px;
      font-size: 16px; cursor: pointer;
      margin-top: 15px; transition: background-color 0.3s;
    }
    button:hover { background-color: #16a085; }
    .toggle { text-align: center; margin-top: 20px; color: #555; }
    .toggle span { color: #1abc9c; cursor: pointer; font-weight: bold; }
    .hidden { display: none; }
    .error-message { color: #e74c3c; text-align: center; margin-top: 15px; font-weight: bold; }
    .success-message { color: #27ae60; text-align: center; margin-top: 15px; font-weight: bold; }
  </style>
</head>
<body>

  <div class="top-bar">
    <a href="main.html" class="logo">중고마켓</a>
  </div>

  <!-- 로그인 폼 -->
  <div class="container" id="loginForm">
    <h2>로그인</h2>
    <label for="loginId">아이디</label>
    <input type="text" id="loginId" placeholder="아이디 입력">
    <label for="loginPw">비밀번호</label>
    <input type="password" id="loginPw" placeholder="비밀번호 입력">
    <button onclick="login()">로그인</button>
    <div class="toggle">
      계정이 없으신가요? <a href="signup.html"><span>회원가입</span></a><br>
      아이디/비밀번호를 잊으셨나요? <span onclick="toggleForm('findId')">아이디 찾기</span>/<span onclick="toggleForm('findPw')">비밀번호 찾기</span>
    </div>
  </div>

  <!-- 아이디 찾기 -->
  <div class="container hidden" id="findIdForm">
    <h2>아이디 찾기</h2>
    <label for="findEmail">가입한 이메일</label>
    <input type="email" id="findEmail" placeholder="가입 시 이메일 입력">
    <button onclick="checkEmail()">다음</button>
    <div id="findMsg" class="error-message hidden"></div>

    <div class="toggle">
      <span onclick="toggleForm('login')">← 로그인으로 돌아가기</span>
    </div>
  </div>

  <!-- 비밀번호 찾기 -->
  <div class="container hidden" id="findPwForm">
    <h2>비밀번호 찾기</h2>
    <label for="findEmail">가입한 이메일</label>
    <input type="email" id="findEmail" placeholder="가입 시 이메일 입력">
    <button onclick="checkEmail()">다음</button>
    <div id="findMsg" class="error-message hidden"></div>

    <div class="toggle">
      <span onclick="toggleForm('login')">← 로그인으로 돌아가기</span>
    </div>
  </div>

  <!-- 비밀번호 재설정 -->
  <div class="container hidden" id="resetPwForm">
    <h2>비밀번호 재설정</h2>
    <label for="newPw">새 비밀번호</label>
    <input type="password" id="newPw" placeholder="새 비밀번호 입력">
    <label for="newPwConfirm">새 비밀번호 확인</label>
    <input type="password" id="newPwConfirm" placeholder="다시 한 번 입력">
    <button onclick="resetPassword()">비밀번호 변경</button>
    <div id="resetMsg"></div>
    <div class="toggle">
      <span onclick="toggleForm('login')">← 로그인으로 돌아가기</span>
    </div>
  </div>

  <script>
    const loginForm = document.getElementById('loginForm');
    const findIdForm = document.getElementById('findIdForm');
    const findPwForm = document.getElementById('findPwForm');
    const resetPwForm = document.getElementById('resetPwForm');
    const findMsg = document.getElementById('findMsg');
    const resetMsg = document.getElementById('resetMsg');
    let currentUser = null;

    function toggleForm(type) {
      loginForm.classList.add('hidden');
      findIdForm.classList.add('hidden');
      findPwForm.classList.add('hidden');
      resetPwForm.classList.add('hidden');

      if (type === 'login') loginForm.classList.remove('hidden');
      else if (type === 'findPw') findPwForm.classList.remove('hidden');
      else if (type === 'findId') findIdForm.classList.remove('hidden');
      else if (type === 'resetPw') resetPwForm.classList.remove('hidden');
    }

    function login() {
      const id = document.getElementById('loginId').value;
      const pw = document.getElementById('loginPw').value;
      const userData = JSON.parse(localStorage.getItem('user'));
      if (!userData) return alert("등록된 회원이 없습니다. 회원가입을 해주세요.");
      if (id === userData.id && pw === userData.pw) {
        alert(`환영합니다 ${id}님!`);
        window.location.href = "s.html";
      } else alert("아이디 또는 비밀번호가 올바르지 않습니다.");
    }

    function checkEmail() {
      const email = document.getElementById('findEmail').value;
      const userData = JSON.parse(localStorage.getItem('user'));
      if (!email) { findMsg.textContent = "이메일을 입력해주세요!"; findMsg.classList.remove('hidden'); return; }
      if (userData && userData.email === email) {
        currentUser = userData;
        toggleForm('resetPw');
      } else {
        findMsg.textContent = "등록된 이메일이 없습니다.";
        findMsg.classList.remove('hidden');
      }
    }

    function resetPassword() {
      const newPw = document.getElementById('newPw').value;
      const confirmPw = document.getElementById('newPwConfirm').value;
      if (!newPw || !confirmPw) { resetMsg.textContent = "모든 칸을 입력해주세요!"; resetMsg.className = "error-message"; return; }
      if (newPw !== confirmPw) { resetMsg.textContent = "비밀번호가 일치하지 않습니다!"; resetMsg.className = "error-message"; return; }

      let userData = JSON.parse(localStorage.getItem('user'));
      userData.pw = newPw;
      localStorage.setItem('user', JSON.stringify(userData));
      resetMsg.textContent = "✅ 비밀번호가 성공적으로 변경되었습니다!";
      resetMsg.className = "success-message";
      setTimeout(() => toggleForm('login'), 2000);
    }
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ìƒí’ˆ ìƒì„¸ - ì¤‘ê³ ë§ˆì¼“</title>
  <link rel="stylesheet" href="style.css" />

  <style>
    body { margin-top: 80px; }
    .detail-container { width: 80%; margin: 50px auto; display: flex; gap: 40px; align-items: flex-start; justify-content: center; }
    .detail-container img { width: 350px; height: 350px; object-fit: cover; border-radius: 10px; border: 1px solid #ddd; }
    .detail-info { flex: 1; max-width: 500px; }
    .detail-info h2 { margin-bottom: 15px; font-size: 24px; }
    .detail-info .price { font-size: 20px; font-weight: bold; color: #c0392b; margin-bottom: 20px; }
    .detail-info .description { line-height: 1.6; white-space: pre-line; }
  </style>
</head>

<body>

<nav>
  <div class="logo"><a href="main.html">Re:Born</a></div>
  <div class="search-bar">
    <div class="search-container">
      <input type="text" id="searchInput" placeholder="ìƒí’ˆëª…, ì¹´í…Œê³ ë¦¬ ê²€ìƒ‰..." oninput="showHideClearButton()" />
      <button class="clear-btn" id="clearBtn" onclick="clearSearchInput()" style="display: none;">&times;</button>
    </div>
  </div>

  <ul class="menu">
    <li id="mypageMenu">
      <a href="#">ë§ˆì´ í˜ì´ì§€</a>
      <ul class="submenu" style="left:-30px;">
        <li><a href="my_info.html">ë‚´ ì •ë³´</a></li>
        <li><a href="goods_reg.html">ë“±ë¡í•œ ìƒí’ˆ ëª©ë¡</a></li>
        <li><a href="rating.html">í›„ê¸° / í‰ì </a></li>
        <li><a href="javascript:void(0);" onclick="openWithdrawPopup()">íƒˆí‡´í•˜ê¸°</a></li>
      </ul>
    </li>
    <li>
      <a id="authLink" href="#">ë¡œê·¸ì¸/íšŒì›ê°€ì…</a>
      <ul class="submenu" id="authSubmenu">
        <li><a href="login.html">ë¡œê·¸ì¸</a></li>
        <li><a href="signup.html">íšŒì›ê°€ì…</a></li>
      </ul>
    </li>
  </ul>
</nav>

<div class="detail-container">
  <img id="productImage" src="https://via.placeholder.com/350" alt="ìƒí’ˆ ì´ë¯¸ì§€">
  <div class="detail-info">
    <h2 id="productTitle">ìƒí’ˆëª… ì˜ˆì‹œ</h2>
    <div class="price" id="productPrice">10,000ì›</div>
    <div class="description" id="productDesc">
      ìƒí’ˆ ì„¤ëª… ì˜ˆì‹œì…ë‹ˆë‹¤.
      ìƒí’ˆ ìƒíƒœëŠ” ì–‘í˜¸í•˜ë©°, ì‚¬ìš©ê°ì€ ê±°ì˜ ì—†ìŠµë‹ˆë‹¤.
      ì§ê±°ë˜/íƒë°° ê°€ëŠ¥.
    </div>
    <div class="seller-name" id="sellerName" style="margin-top:18px; font-size:15px; color:#555; cursor:pointer;">
      íŒë§¤ì: <strong>dbì˜ì‹ </strong>
    </div>
    <div style="margin-top: 20px; display: flex; gap: 12px;">
      <button id="buyBtn" style="padding:12px 25px; background:#2c7be5; color:white; border:none; border-radius:6px; font-size:16px; cursor:pointer;">
        êµ¬ë§¤í•˜ê¸°
      </button>
      <button id="likeBtn" style="padding:12px 20px; background:#e74c3c; color:white; border:none; border-radius:6px; font-size:16px; cursor:pointer;">
        â™¥ ì¢‹ì•„ìš”
      </button>
    </div>
  </div>
</div>

<script>
function openWithdrawPopup() {
  const popupWidth = 500;
  const popupHeight = 650;
  const left = (window.screen.width / 2) - (popupWidth / 2);
  const top = (window.screen.height / 2) - (popupHeight / 2);
  const options = `width=${popupWidth},height=${popupHeight},left=${left},top=${top},status=no,menubar=no,toolbar=no,resizable=no`;
  window.open("withdraw.html", "withdrawPopup", options);
}

function clearSearchInput() {
  const searchInput = document.getElementById('searchInput');
  searchInput.value = '';
  showHideClearButton();
  searchInput.focus();
}

function showHideClearButton() {
  const searchInput = document.getElementById('searchInput');
  const clearBtn = document.getElementById('clearBtn');
  clearBtn.style.display = searchInput.value.length > 0 ? 'block' : 'none';
}

// ğŸ”¹ ìƒí’ˆ ìƒì„¸ ë¶ˆëŸ¬ì˜¤ê¸°
async function loadProduct() {
  const params = new URLSearchParams(window.location.search);
  const productId = params.get("id");
  if (!productId) { alert("ìƒí’ˆ ID ì—†ìŒ"); return; }

  try {
    const res = await fetch(`/product/${productId}`, { credentials: "include" });
    if (!res.ok) throw new Error("ìƒí’ˆ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨");

    const product = await res.json();

    document.getElementById("productImage").src = product.image_url;
    document.getElementById("productTitle").textContent = product.title;
    document.getElementById("productPrice").textContent = product.price.toLocaleString() + "ì›";
    document.getElementById("productDesc").textContent = product.description || "";
    document.getElementById("sellerName").innerHTML = `íŒë§¤ì: <strong>${product.username}</strong>`;

    // ì°œ ë²„íŠ¼ í´ë¦­
    document.getElementById("likeBtn").addEventListener("click", async function () {
      try {
        const res = await fetch("/wishlist/add", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ productId: product.product_id }),
          credentials: "include"
        });
        const result = await res.json();
        alert(result.message);
      } catch (err) {
        alert("ì°œ ì¶”ê°€ ì‹¤íŒ¨: ë¡œê·¸ì¸ í•„ìš”");
      }
    });

  } catch (err) {
    console.error(err);
    alert("ìƒí’ˆ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
  }
}

// êµ¬ë§¤ ë²„íŠ¼
document.getElementById("buyBtn").addEventListener("click", () => {
  alert("êµ¬ë§¤ ìš”ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! íŒë§¤ìì™€ ì±„íŒ…ì„ ì‹œì‘í•©ë‹ˆë‹¤.");
});

document.getElementById("sellerName").addEventListener("click", () => {
  window.location.href = 'seller.html';
});

// í˜ì´ì§€ ë¡œë“œ ì‹œ ìƒí’ˆ ë¶ˆëŸ¬ì˜¤ê¸°
loadProduct();
</script>

</body>
</html>

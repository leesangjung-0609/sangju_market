<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Re:Born - íšŒì› íƒˆí‡´</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    /* ğŸ”¥ ìƒë‹¨ ì—¬ë°± ì¤„ì´ê¸° (ê¸°ì¡´ margin-top: 90px ë®ì–´ì“°ê¸°) */
    main.container {
      margin-top: 20px !important;
    }


      /* body ì „ì²´ ë†’ì´ ìµœì†Œí™” */
    body {
      min-height: 100vh;
      display: flex;
      justify-content: center; /* ê°€ë¡œ ì¤‘ì•™ */
      align-items: flex-start; /* ìƒë‹¨ ì •ë ¬ (ì›í•˜ë©´ centerë¡œ í•˜ë©´ ì„¸ë¡œ ì¤‘ì•™) */
      padding: 0;
      background-color: #f8f9fa;
    }
  </style>
</head>

<body>

  <main class="container">
    <section id="withdraw" class="page-section">
      <h2>íšŒì› íƒˆí‡´</h2>
      <div class="withdraw-warning">
        <h4>ì •ë§ íƒˆí‡´í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</h4>
        <p>íƒˆí‡´ ì‹œ ëª¨ë“  ê³„ì • ì •ë³´, íŒë§¤ ë‚´ì—­, í›„ê¸°, ì°œ ëª©ë¡ì´ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë˜ë©° ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì‹ ì¤‘í•˜ê²Œ ê²°ì •í•´ì£¼ì„¸ìš”.</p>
      </div>

      <form onsubmit="return false;">
        <div class="form-group">
          <label for="pw-confirm">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
          <input type="password" id="pw-confirm" placeholder="ë³¸ì¸ í™•ì¸ì„ ìœ„í•´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”." />
        </div>

        <button type="button" class="btn btn-danger" onclick="confirmWithdrawal()">
          íšŒì› íƒˆí‡´
        </button>
      </form>
    </section>
  </main>

  <script>
    async function confirmWithdrawal() {
      // 1. í˜ì´ì§€ì˜ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ì°½ì—ì„œ ê°’ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
      const passwordOnPage = document.getElementById('pw-confirm').value;

      // 2. ì…ë ¥ê°’ì´ ë¹„ì–´ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
      if (passwordOnPage === '') {
        alert('ë¹„ë°€ë²ˆí˜¸ë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”.');
        document.getElementById('pw-confirm').focus();
        return;
      }

      // 3. ì‚¬ìš©ìì—ê²Œ ìµœì¢… í™•ì¸ì„ ë°›ìŠµë‹ˆë‹¤.
      if (confirm("ì •ë§ íƒˆí‡´í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.)")) {
        try {
          // 4. ì„œë²„ì— DELETE ìš”ì²­ ì „ì†¡
          const response = await fetch('/user/withdraw', {
            method: 'DELETE',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ password: passwordOnPage })
          });

          const message = await response.text();

          if (response.ok) {
            // ì„±ê³µì ìœ¼ë¡œ íƒˆí‡´ ì²˜ë¦¬
            alert(message);
            if (window.opener && !window.opener.closed) {
              // ë¶€ëª¨ ì°½(main.html)ì— ìˆëŠ” ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬ í•¨ìˆ˜ í˜¸ì¶œ
              window.opener.handleLogoutAfterWithdrawal();
            }

            window.close(); // ë˜ëŠ” location.href = '/'
          } else {
            // íƒˆí‡´ ì‹¤íŒ¨
            alert('íƒˆí‡´ ì‹¤íŒ¨: ' + message);
          }
        } catch (error) {
          console.error('ë„¤íŠ¸ì›Œí¬ ë˜ëŠ” ì„œë²„ ì˜¤ë¥˜:', error);
          alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.');
        }
      } else {
        // 'ì·¨ì†Œ'ë¥¼ ëˆ„ë¥¸ ê²½ìš°
        alert('íƒˆí‡´ê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
      }
    }

    function clearSearchInput() {
      const searchInput = document.getElementById('searchInput');
      searchInput.value = '';
      showHideClearButton();
      searchInput.focus();
    }

    function showHideClearButton() {
      const searchInput = document.getElementById('searchInput');
      const clearBtn = document.getElementById('clearBtn');

      if (searchInput.value.length > 0) {
        clearBtn.style.display = 'block';
      } else {
        clearBtn.style.display = 'none';
      }
    }
  </script>

</body>


</html>
